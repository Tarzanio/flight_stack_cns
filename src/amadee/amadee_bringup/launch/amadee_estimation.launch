<?xml version="1.0" encoding="UTF-8"?>
<launch>
  <arg name="pi"                        default="1" />
  <arg name="use_openvins"              default="True" /> <!-- if False it will use mocap -->
  <arg name="use_px4_bridge"            default="False" /> <!-- if False it will setup mars to input into PX4 EKF2 -->

  <!-- OV arguments -->
  <arg name="ov_imu_in"           default="/mavros/imu/data_raw" />
  <arg name="ov_cam_in1"          default="/mission_cam/image_raw" />
  <arg name="ov_cam_in2"          default="/mission_cam/image_raw" />
  <arg name="ov_use_stereo"       default="False" />

  <!-- MaRS arguments -->
  <arg name="mars_imu_in"               default="/mavros/imu/data_raw" />
  <arg name="mars_transform_in"         default="/twins_amadee/vrpn_client/raw_transform" />
  <arg name="mars_pose_in"              default="/ov_msckf/poseimu" />
  <arg name="mars_pose_out"             default="/mavros/vision_pose/pose" />
  <arg name="mars_lite_ext_state_out"   default="/mavros/external_state_lite/external_state_estimate_lite" />

  <group if="$(eval arg('pi') == 1)">
    <!-- MaRS Estimator -->
    <include file="$(find mars_ros)/launch/mars_pose.launch" >
      <arg name="imu_in_topic"                  value="$(arg mars_imu_in)" />
      <arg name="transform_in_topic"            value="$(arg mars_transform_in)" unless="$(arg use_openvins)" />
      <arg name="pose_with_cov_in_topic"        value="$(arg mars_pose_in)" if="$(arg use_openvins)" />
      <arg name="full_state_lite_out_topic"     value="$(arg mars_lite_ext_state_out)" if="$(arg use_px4_bridge)" />
      <arg name="pose_state_out_topic"          value="$(arg mars_pose_out)" unless="$(arg use_px4_bridge)"  />
    </include>
  </group>

  <group if="$(eval arg('pi') == 2)">
    <!-- OpenVINS Estimator -->
    <include file="$(find amadee_bringup)/launch/openvins.launch" if="$(arg use_openvins)" >
      <arg name="topic_imu"     value="$(arg ov_imu_in)" />
      <arg name="topic_camera0" value="$(arg ov_cam_in1)" />
      <arg name="topic_camera1" value="$(arg ov_cam_in2)" />
      <arg name="use_stereo"    value="$(arg ov_use_stereo)" />
    </include>
  </group>
</launch>
